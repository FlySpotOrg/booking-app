name: Smoke Test Run

on:
  workflow_dispatch:    # or `push` / `workflow_dispatch` as you need

jobs:
  dispatch-and-wait:
    runs-on: ubuntu-latest

    steps:
      - name: Dispatch & wait for smoke suite
        id: dispatch_and_wait
        uses: convictional/trigger-workflow-and-wait@v1.6.5
        with:
          owner: FlySpotOrg
          repo: playwrightDemoProject
          github_token: ${{ secrets.REPO_A_PAT }}
          workflow_file_name: playwright-test-run.yml
          ref: ${{ github.ref_name }}
          client_payload: >-
            {"test_scope":"smoke"}
          wait_interval: 15
          propagate_failure: true

      - name: Publish report link
        run: |
          RUN_ID=${{ steps.dispatch_and_wait.outputs.run-number }}
          echo "### âœ… Allure Report: https://flyspotorg.github.io/playwrightDemoProject/smoke/${RUN_ID}/" >> $GITHUB_STEP_SUMMARY